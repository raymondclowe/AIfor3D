<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STL Export Test</title>
    
    <!-- Three.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="STLExporter.js"></script>
    
    <style>
        body { margin: 0; overflow: hidden; }
        #info {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            color: white;
            background-color: rgba(0,0,0,0.7);
            padding: 5px;
            z-index: 100;
        }
        #exportBtn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="info">STL Export Test - One cube and one 1x2x3 block</div>
    <button id="exportBtn">Export to test.stl</button>
    
    <script>
        // Initialize scene, camera, and renderer
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        
        // Add lighting
        const ambientLight = new THREE.AmbientLight(0x404040);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight.position.set(1, 1, 1);
        scene.add(directionalLight);
        
        // Create a 1x1x1 cube
        const cubeGeometry = new THREE.BoxGeometry(1, 1, 1);
        const cubeMaterial = new THREE.MeshStandardMaterial({ color: 0x00ff00 });
        const cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
        cube.position.x = -2;
        scene.add(cube);
        
        // Create a 1x2x3 block
        const blockGeometry = new THREE.BoxGeometry(1, 2, 3);
        const blockMaterial = new THREE.MeshStandardMaterial({ color: 0x0000ff });
        const block = new THREE.Mesh(blockGeometry, blockMaterial);
        block.position.x = 2;
        scene.add(block);
        
        // Position camera
        camera.position.z = 5;
        
        // Export to STL
        function exportToSTL() {
            const exporter = new THREE.STLExporter();
            const result = exporter.parse(scene, { binary: false }); // ASCII format
            
            // Create a blob and download the file
            const blob = new Blob([result], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'test.stl';
            link.click();
            
            console.log('STL export completed');
            document.getElementById('info').textContent = 'STL Export Test - Exported to test.stl';
            
            // Log the first 500 characters of the STL content to console for verification
            console.log('STL content preview:');
            console.log(result.substring(0, 500) + '...');
        }
        
        // Simple animation loop
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }
        
        // Start animation
        animate();
        
        // Add event listener to export button
        document.getElementById('exportBtn').addEventListener('click', exportToSTL);
        
        // Also export automatically after a short delay
        setTimeout(exportToSTL, 1000);
    </script>
</body>
</html>
